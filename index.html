<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Ausentismo SST</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: #f4f6f9;
}

header {
    background-color: #163a63;
    color: white;
    padding: 25px;
    text-align: center;
}

.container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    padding: 20px;
}

.card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.kpi {
    font-size: 32px;
    font-weight: bold;
    margin-top: 10px;
}

.meta {
    font-size: 13px;
    color: #555;
}
</style>
</head>

<body>

<header>
<h1>Dashboard Ausentismo 2025</h1>
<p>Análisis automático desde Google Sheets</p>
</header>

<div class="container">

<div class="card">
<h3>Total Casos</h3>
<div id="totalCasos" class="kpi">Cargando...</div>
<p class="meta">Número total de incapacidades registradas</p>
</div>

<div class="card">
<h3>Total Días Perdidos</h3>
<div id="totalDias" class="kpi">Cargando...</div>
<p class="meta">Suma de días de incapacidad</p>
</div>

<div class="card">
<h3>Promedio Días por Caso</h3>
<div id="promedioDias" class="kpi">Cargando...</div>
<p class="meta">Días promedio por incapacidad</p>
</div>

<div class="card">
<h3>% Origen Laboral</h3>
<div id="origenLaboral" class="kpi">Cargando...</div>
<p class="meta">Porcentaje de casos de origen laboral</p>
</div>

</div>

<script>

async function cargarDatos() {

    const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSH0v565bjWRWmTAAeR0XtaeQCw0BSVdmK_lAKlJz70SxXq44COlx5vIRlCcvXwXg/pub?gid=1737014280&single=true&output=csv";

    const response = await fetch(url);
    const texto = await response.text();

    const filas = texto.trim().split("\n").slice(1);

    let totalCasos = filas.length;
    let totalDias = 0;
    let casosLaborales = 0;

    filas.forEach(fila => {
        const columnas = fila.split(",");

        // Columna 8 = DIAS INCAPACIDAD
        totalDias += parseFloat(columnas[7]) || 0;

        // Columna 11 = ORIGEN
        if (columnas[10] && columnas[10].toLowerCase().includes("laboral")) {
            casosLaborales++;
        }
    });

    const promedioDias = totalDias / totalCasos;
    const porcentajeLaboral = (casosLaborales / totalCasos) * 100;

    document.getElementById("totalCasos").innerText = totalCasos;
    document.getElementById("totalDias").innerText = totalDias;
    document.getElementById("promedioDias").innerText = promedioDias.toFixed(1);
    document.getElementById("origenLaboral").innerText = porcentajeLaboral.toFixed(1) + "%";
}

cargarDatos();

</script>

</body>
</html>
